<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>TenPercent</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    .win { color: green; }
    .loss { color: red; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #aaa; padding: 4px 8px; text-align: center; }
  </style>
</head>
<body>
  <h1>TenPercent</h1>

  <label>Player Name: <input type="text" id="nameInput"></label>
  <br><br>

  <label>Bet: <span id="betVal">5</span></label>
  <input type="range" min="1" max="10" value="5" id="betSlider">
  <br><br>

  <label>Round Timer (seconds): <input type="number" min="1" max="60" value="10" id="timerInput"></label>
  <br><br>

  <p id="warning" style="color: orange; font-weight: bold;"></p>
  <p>Timer: <span id="timer">10</span></p>

  <h2>Players</h2>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Balance</th>
        <th>Last Bet</th>
        <th>Last Round Gain/Loss</th>
      </tr>
    </thead>
    <tbody id="playersBody"></tbody>
  </table>

  <script>
    const socket = io();
    const roomId = 'room1';
    let name = 'Player_' + Math.floor(Math.random()*1000);

    // Join room
    socket.emit('joinRoom', { roomId, name });

    // Name input
    const nameInput = document.getElementById('nameInput');
    nameInput.value = name;
    nameInput.addEventListener('input', () => {
      name = nameInput.value;
      socket.emit('setName', { roomId, name });
    });

    // Bet slider
    const slider = document.getElementById('betSlider');
    const betVal = document.getElementById('betVal');
    slider.addEventListener('input', () => {
      betVal.textContent = slider.value;
      socket.emit('setBet', { roomId, bet: parseInt(slider.value) });
    });

    // Timer input
    const timerInput = document.getElementById('timerInput');
    timerInput.addEventListener('input', () => {
      const val = parseInt(timerInput.value);
      socket.emit('setTimer', { roomId, timer: val });
    });

    // Warnings
    socket.on('warning', msg => {
      document.getElementById('warning').textContent = msg;
    });

    // Timer update
    socket.on('timer', t => {
      document.getElementById('timer').textContent = t;
      document.getElementById('warning').textContent = ''; // clear warning when round starts
    });

    // Update players table
    socket.on('playersUpdate', players => {
      const tbody = document.getElementById('playersBody');
      tbody.innerHTML = '';
      for (const [id, p] of Object.entries(players)) {
        const tr = document.createElement('tr');
        const gainCell = document.createElement('td');
        if(p.lastResult) {
          gainCell.textContent = (p.lastResult.amount >= 0 ? '+' : '') + p.lastResult.amount;
          gainCell.className = p.lastResult.win ? 'win' : 'loss';
        } else {
          gainCell.textContent = '-';
        }

        const lastBetCell = document.createElement('td');
        lastBetCell.textContent = p.lastResult ? p.lastResult.lastBet : '-';

        tr.innerHTML = `<td>${p.name}</td>
                        <td>${p.balance}</td>`;
        tr.appendChild(lastBetCell);
        tr.appendChild(gainCell);

        tbody.appendChild(tr);
      }
    });
  </script>
</body>
</html>
